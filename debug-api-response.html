<!DOCTYPE html>
<html>
<head>
    <title>Debug API Response</title>
</head>
<body>
    <h1>Debug Price Charting API Response</h1>
    
    <div>
        <input type="text" id="searchInput" placeholder="Enter product name" value="charizard">
        <button onclick="testAPI()">Test API</button>
    </div>
    
    <div>
        <h2>Raw API Response:</h2>
        <pre id="rawResponse"></pre>
    </div>
    
    <div>
        <h2>Processed Data:</h2>
        <pre id="processedData"></pre>
    </div>

    <script>
        // Replace these with your actual Supabase values
        const SUPABASE_URL = 'https://your-project-ref.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key-here';
        
        async function testAPI() {
            const searchInput = document.getElementById('searchInput').value;
            const rawDiv = document.getElementById('rawResponse');
            const processedDiv = document.getElementById('processedData');
            
            rawDiv.textContent = 'Loading...';
            processedDiv.textContent = 'Loading...';
            
            try {
                const response = await fetch(`${SUPABASE_URL}/functions/v1/price-charting/search?q=${encodeURIComponent(searchInput)}`, {
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                    },
                });
                
                const data = await response.json();
                
                // Show raw response
                rawDiv.textContent = JSON.stringify(data, null, 2);
                
                // Process the data like the frontend does
                let products = [];
                
                if (data.success && data.data) {
                    if (data.data.products && Array.isArray(data.data.products)) {
                        products = data.data.products;
                    } else if (Array.isArray(data.data)) {
                        products = data.data;
                    } else if (data.data.product) {
                        products = [data.data.product];
                    }
                    
                    const formattedResults = products.map(product => {
                        return {
                            product_id: product.id || product.product_id || '',
                            product_name: product.product_name || product.name || 'Unknown Product',
                            console_name: product.console_name || product.console || '',
                            loose_price: product.loose_price || product.price || '',
                            cib_price: product.cib_price || product.complete_price || '',
                            new_price: product.new_price || product.sealed_price || '',
                            image_url: product.image_url || product.image || '',
                        };
                    });
                    
                    processedDiv.textContent = JSON.stringify(formattedResults, null, 2);
                } else {
                    processedDiv.textContent = 'No data found or API error';
                }
                
            } catch (error) {
                rawDiv.textContent = 'Error: ' + error.message;
                processedDiv.textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
